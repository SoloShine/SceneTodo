<UserControl x:Class="SceneTodo.Views.TagsPanelControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:hc="https://handyorg.github.io/handycontrol"
             xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
             d:DesignHeight="450" d:DesignWidth="200"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <Border Grid.Row="0" 
                BorderThickness="0,0,0,1" 
                BorderBrush="{DynamicResource BorderBrush}"
                Padding="8">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0"
                          Text="Tags"
                          FontSize="16"
                          FontWeight="Bold"
                          Margin="0,0,0,8"/>

                <StackPanel Grid.Row="1" Orientation="Horizontal">
                    <Button Click="AddTag_Click"
                            ToolTip="New Tag"
                            Style="{StaticResource ButtonPrimary}"
                            Padding="6,4"
                            Margin="0,0,4,0">
                        <iconPacks:PackIconBootstrapIcons Kind="PlusCircle" Width="10" Height="10"/>
                    </Button>

                    <Button Click="ManageTags_Click"
                            ToolTip="Manage Tags"
                            Style="{StaticResource ButtonDefault}"
                            Padding="6,4"
                            Margin="0,0,4,0">
                        <iconPacks:PackIconGameIcons Kind="Cog" Width="10" Height="10"/>
                    </Button>

                    <Button Click="RefreshTags_Click"
                            ToolTip="Refresh"
                            Style="{StaticResource ButtonDefault}"
                            Padding="6,4">
                        <iconPacks:PackIconMaterialDesign Kind="Refresh" Width="10" Height="10"/>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Current filter status display -->
        <Border Grid.Row="1"
               x:Name="FilterStatusBorder"
               Visibility="Collapsed"
               Background="{DynamicResource InfoBrush}"
               Padding="8,6"
               Margin="8,8,8,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <TextBlock Grid.Column="0"
                          x:Name="FilterStatusText"
                          FontSize="11"
                          Foreground="White"
                          VerticalAlignment="Center"/>
                
                <Button Grid.Column="1"
                       Click="ClearFilter_Click"
                       ToolTip="Clear Filter"
                       Style="{StaticResource ButtonDefault}"
                       Padding="4,2"
                       Margin="4,0,0,0">
                    <iconPacks:PackIconMaterialDesign Kind="Close" Width="10" Height="10"/>
                </Button>
            </Grid>
        </Border>

        <ScrollViewer Grid.Row="2" 
                     VerticalScrollBarVisibility="Auto"
                     Padding="8"
                     Margin="0,8,0,0">
            <ItemsControl x:Name="TagsItemsControl">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Margin="0,0,0,6"
                               Padding="8"
                               Background="{DynamicResource SecondaryRegionBrush}"
                               CornerRadius="4"
                               BorderThickness="1"
                               BorderBrush="{DynamicResource BorderBrush}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <Grid Grid.Row="0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <Border Grid.Column="0"
                                           Width="12"
                                           Height="12"
                                           Background="{Binding ColorBrush}"
                                           CornerRadius="6"
                                           Margin="0,0,6,0"
                                           VerticalAlignment="Center"/>

                                    <TextBlock Grid.Column="1"
                                              Text="{Binding Name}"
                                              FontWeight="Medium"
                                              TextTrimming="CharacterEllipsis"
                                              VerticalAlignment="Center"/>
                                </Grid>

                                <Grid Grid.Row="1" Margin="0,4,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0"
                                              FontSize="10"
                                              Foreground="{DynamicResource SecondaryTextBrush}"
                                              VerticalAlignment="Center">
                                        <Run Text="Used: "/>
                                        <Run Text="{Binding UsageCount}" FontWeight="Bold"/>
                                    </TextBlock>

                                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                                        <Button Click="FilterByTag_Click"
                                               Tag="{Binding}"
                                               ToolTip="Filter by this tag"
                                               Style="{StaticResource ButtonPrimary}"
                                               Padding="4,2"
                                               Margin="0,0,2,0">
                                            <iconPacks:PackIconMaterialDesign Kind="FilterOutline" Width="8" Height="8"/>
                                        </Button>

                                        <Button Click="EditTag_Click"
                                               Tag="{Binding}"
                                               ToolTip="Edit"
                                               Style="{StaticResource ButtonDefault}"
                                               Padding="4,2"
                                               Margin="0,0,2,0">
                                            <iconPacks:PackIconFeatherIcons Kind="Edit" Width="8" Height="8"/>
                                        </Button>

                                        <Button Click="DeleteTag_Click"
                                               Tag="{Binding}"
                                               ToolTip="Delete"
                                               Style="{StaticResource ButtonDanger}"
                                               Padding="4,2">
                                            <iconPacks:PackIconMaterial Kind="DeleteOutline" Width="8" Height="8"/>
                                        </Button>
                                    </StackPanel>
                                </Grid>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <Border Grid.Row="3"
               BorderThickness="0,1,0,0"
               BorderBrush="{DynamicResource BorderBrush}"
               Padding="8"
               Background="{DynamicResource SecondaryRegionBrush}">
            <TextBlock FontSize="11"
                      Foreground="{DynamicResource SecondaryTextBrush}"
                      HorizontalAlignment="Center"
                      x:Name="TotalTagsText"/>
        </Border>
    </Grid>
</UserControl>
