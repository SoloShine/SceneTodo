<UserControl
    x:Class="SceneTodo.Views.HistoryUserControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:hc="https://handyorg.github.io/handycontrol"
    xmlns:converters="clr-namespace:SceneTodo.Converters"
    xmlns:vm="clr-namespace:SceneTodo.ViewModels"
    Background="{DynamicResource RegionBrush}">
    
    <UserControl.DataContext>
        <vm:HistoryWindowViewModel />
    </UserControl.DataContext>
    
    <UserControl.Resources>
        <converters:DateTimeToStringConverter x:Key="DateTimeToStringConverter" />
        <converters:PriorityToBorderBrushConverter x:Key="PriorityToBorderBrushConverter" />
    </UserControl.Resources>

    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Filter Panel -->
        <GroupBox Grid.Row="0" Header="Filter" Margin="0,0,0,10">
            <StackPanel Orientation="Horizontal" Margin="10">
                <TextBlock Text="Start Date:" VerticalAlignment="Center" Margin="0,0,10,0" />
                <hc:DatePicker 
                    Width="150" 
                    Margin="0,0,20,0"
                    SelectedDate="{Binding StartDate}" />

                <TextBlock Text="End Date:" VerticalAlignment="Center" Margin="0,0,10,0" />
                <hc:DatePicker 
                    Width="150" 
                    Margin="0,0,20,0"
                    SelectedDate="{Binding EndDate}" />

                <Button 
                    Content="Filter" 
                    Command="{Binding FilterCommand}"
                    Padding="15,5"
                    Style="{StaticResource ButtonPrimary}" />
            </StackPanel>
        </GroupBox>

        <!-- History List -->
        <DataGrid 
            x:Name="HistoryDataGrid"
            Grid.Row="1"
            ItemsSource="{Binding HistoryItems}"
            AutoGenerateColumns="False"
            CanUserAddRows="False"
            CanUserDeleteRows="False"
            SelectionMode="Single"
            GridLinesVisibility="Horizontal"
            HeadersVisibility="Column"
            Background="{DynamicResource RegionBrush}">
            
            <DataGrid.Columns>
                <!-- Priority Indicator -->
                <DataGridTemplateColumn Header="Priority" Width="80">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Border 
                                BorderBrush="{Binding Priority, Converter={StaticResource PriorityToBorderBrushConverter}}"
                                BorderThickness="3"
                                CornerRadius="2"
                                Width="50"
                                Height="20" />
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <!-- Content -->
                <DataGridTextColumn 
                    Header="Content" 
                    Binding="{Binding Content}" 
                    Width="*"
                    IsReadOnly="True" />

                <!-- Description -->
                <DataGridTextColumn 
                    Header="Description" 
                    Binding="{Binding Description}" 
                    Width="200"
                    IsReadOnly="True" />

                <!-- Completed Time -->
                <DataGridTextColumn 
                    Header="Completed Time" 
                    Binding="{Binding CompletedAt, Converter={StaticResource DateTimeToStringConverter}}" 
                    Width="150"
                    IsReadOnly="True" />

                <!-- Actions -->
                <DataGridTemplateColumn Header="Actions" Width="180">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <Button
                                    Content="Restore"
                                    Command="{Binding DataContext.RestoreTodoCommand, ElementName=HistoryDataGrid}"
                                    CommandParameter="{Binding}"
                                    Margin="0,0,5,0"
                                    Padding="10,3"
                                    Style="{StaticResource ButtonSuccess}" />
                                <Button
                                    Content="Delete"
                                    Command="{Binding DataContext.DeleteHistoryCommand, ElementName=HistoryDataGrid}"
                                    CommandParameter="{Binding}"
                                    Padding="10,3"
                                    Style="{StaticResource ButtonDanger}" />
                            </StackPanel>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>
    </Grid>
</UserControl>
