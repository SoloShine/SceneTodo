<hc:Window
    x:Class="SceneTodo.Views.EditTodoItemWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="clr-namespace:SceneTodo.Converters"
    xmlns:hc="https://handyorg.github.io/handycontrol"
    xmlns:models="clr-namespace:SceneTodo.Models"
    xmlns:sys="clr-namespace:System;assembly=mscorlib"
    Title="编辑待办项"
    Width="700"
    Height="650"
    Background="{DynamicResource RegionBrush}"
    WindowStartupLocation="CenterScreen">
    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!--  主内容区域 - 使用ScrollViewer支持滚动  -->
        <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto">
            <StackPanel>
                
                <!--  基本信息分组  -->
                <Expander Header="📋 基本信息" IsExpanded="True" Margin="0,0,0,10">
                    <Grid Margin="10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="10"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="10"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="10"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        
                        <!--  左列：内容和描述  -->
                        <StackPanel Grid.Row="0" Grid.Column="0" Grid.RowSpan="5">
                            <!--  内容  -->
                            <TextBlock Text="待办内容:" Margin="0,0,0,5"/>
                            <TextBox x:Name="ContentTextBox" Padding="5" Height="30"/>
                            
                            <!--  描述  -->
                            <TextBlock Text="描述:" Margin="0,15,0,5"/>
                            <TextBox
                                x:Name="DescriptionTextBox"
                                Height="120"
                                Padding="5"
                                VerticalContentAlignment="Top"
                                AcceptsReturn="True"
                                TextWrapping="Wrap"
                                VerticalScrollBarVisibility="Auto" />
                        </StackPanel>
                        
                        <!--  右列：类型和优先级  -->
                        <StackPanel Grid.Row="0" Grid.Column="2">
                            <TextBlock Text="待办类型:" Margin="0,0,0,5"/>
                            <ComboBox
                                x:Name="AppTypeComboBox"
                                Padding="5"
                                DisplayMemberPath="Value"
                                SelectedValuePath="Key" />
                        </StackPanel>
                        
                        <StackPanel Grid.Row="2" Grid.Column="2">
                            <TextBlock Text="优先级:" Margin="0,0,0,5"/>
                            <ComboBox x:Name="PriorityComboBox" Padding="5">
                                <ComboBoxItem Content="极低" Tag="VeryLow" />
                                <ComboBoxItem Content="低" Tag="Low" />
                                <ComboBoxItem Content="中" Tag="Medium" IsSelected="True" />
                                <ComboBoxItem Content="高" Tag="High" />
                                <ComboBoxItem Content="极高" Tag="VeryHigh" />
                            </ComboBox>
                        </StackPanel>
                        
                        <StackPanel Grid.Row="4" Grid.Column="2">
                            <TextBlock x:Name="AppNameTextBlock" Text="应用名称:" Margin="0,0,0,5"/>
                            <TextBox x:Name="AppNameTextBox" Padding="5"/>
                        </StackPanel>
                    </Grid>
                </Expander>

                <!--  应用绑定设置分组  -->
                <Expander x:Name="AppSettingsExpander" Header="🔗 应用绑定设置" IsExpanded="False" Margin="0,0,0,10">
                    <StackPanel Margin="10">
                        <!--  应用路径  -->
                        <TextBlock x:Name="AppPathTextBlock" Text="应用路径:" Margin="0,0,0,5"/>
                        <Grid Margin="0,0,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <TextBox
                                x:Name="AppPathTextBox"
                                Grid.Column="0"
                                Padding="5" />
                            <Button
                                x:Name="SelectAppButton"
                                Grid.Column="1"
                                Margin="5,0,0,0"
                                Padding="10,5"
                                Content="选择软件" />
                        </Grid>
                        
                        <!--  遮盖层位置  -->
                        <TextBlock Text="遮盖层位置:" Margin="0,0,0,5"/>
                        <StackPanel x:Name="OverlayPositionPanel">
                            <ComboBox x:Name="OverlayPositionComboBox" Padding="5" Margin="0,0,0,10">
                                <ComboBoxItem Content="窗口下方" Tag="Bottom" IsSelected="True" />
                                <ComboBoxItem Content="左上角" Tag="TopLeft" />
                                <ComboBoxItem Content="右上角" Tag="TopRight" />
                                <ComboBoxItem Content="左下角" Tag="BottomLeft" />
                                <ComboBoxItem Content="右下角" Tag="BottomRight" />
                                <ComboBoxItem Content="居中" Tag="Center" />
                            </ComboBox>
                        
                            <!--  偏移量  -->
                            <TextBlock Text="偏移量调整:" Margin="0,0,0,5"/>
                            <Grid x:Name="OverlayOffsetPanel">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="20" />
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="X 轴:" VerticalAlignment="Center" Margin="0,0,8,0" />
                                <hc:NumericUpDown 
                                    x:Name="OverlayOffsetXNumericUpDown"
                                    Grid.Column="1"
                                    Minimum="-1000"
                                    Maximum="1000"
                                    Value="0"
                                    Increment="10" />
                                <TextBlock Grid.Column="3" Text="Y 轴:" VerticalAlignment="Center" Margin="0,0,8,0" />
                                <hc:NumericUpDown 
                                    x:Name="OverlayOffsetYNumericUpDown"
                                    Grid.Column="4"
                                    Minimum="-1000"
                                    Maximum="1000"
                                    Value="0"
                                    Increment="10" />
                            </Grid>
                        </StackPanel>
                    </StackPanel>
                </Expander>

                <!--  时间设置分组  -->
                <Expander Header="⏰ 时间设置" IsExpanded="False" Margin="0,0,0,10">
                    <Grid Margin="10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="15"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="10"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="10"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        
                        <!--  开始时间  -->
                        <StackPanel Grid.Row="0" Grid.Column="0">
                            <TextBlock Text="开始时间:" Margin="0,0,0,5"/>
                            <hc:DateTimePicker x:Name="StartTimePicker" />
                        </StackPanel>
                        
                        <!--  结束时间  -->
                        <StackPanel Grid.Row="0" Grid.Column="2">
                            <TextBlock Text="结束时间:" Margin="0,0,0,5"/>
                            <hc:DateTimePicker x:Name="EndTimePicker" />
                        </StackPanel>
                        
                        <!--  提醒时间  -->
                        <StackPanel Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="3">
                            <TextBlock Text="提醒时间:" Margin="0,0,0,5"/>
                            <hc:DateTimePicker x:Name="ReminderTimePicker" />
                        </StackPanel>
                    </Grid>
                </Expander>

                <!--  关联操作分组  -->
                <Expander Header="🔗 关联操作" IsExpanded="False" Margin="0,0,0,10">
                    <StackPanel Margin="10">
                        <Grid Margin="0,0,0,5">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="快速操作列表（点击待办项可执行）:" Grid.Column="0" VerticalAlignment="Center" />
                            <Button
                                x:Name="AddLinkedActionButton"
                                Grid.Column="1"
                                Content="➕ 添加操作"
                                Padding="10,5"
                                Style="{StaticResource ButtonPrimary}"
                                Click="AddLinkedActionButton_Click" />
                        </Grid>
                        <ListBox
                            x:Name="LinkedActionsListBox"
                            Height="120"
                            Background="{DynamicResource SecondaryRegionBrush}">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <Grid Margin="5">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <Border Grid.Column="0" 
                                               Background="{DynamicResource PrimaryBrush}" 
                                               CornerRadius="3" 
                                               Padding="5,2"
                                               Margin="0,0,8,0">
                                            <TextBlock Text="{Binding DisplayName}" 
                                                      Foreground="White"
                                                      FontSize="11"/>
                                        </Border>
                                        <TextBlock Grid.Column="1" 
                                                  Text="{Binding ActionTarget}" 
                                                  VerticalAlignment="Center"
                                                  Foreground="{DynamicResource SecondaryTextBrush}"
                                                  TextTrimming="CharacterEllipsis"/>
                                        <Button
                                            Grid.Column="2"
                                            Content="编辑"
                                            Margin="5,0"
                                            Padding="8,3"
                                            Tag="{Binding}"
                                            Click="EditLinkedActionButton_Click" />
                                        <Button
                                            Grid.Column="3"
                                            Content="删除"
                                            Padding="8,3"
                                            Tag="{Binding}"
                                            Style="{StaticResource ButtonDanger}"
                                            Click="DeleteLinkedActionButton_Click" />
                                    </Grid>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </StackPanel>
                </Expander>
                
            </StackPanel>
        </ScrollViewer>

        <!--  底部按钮区域  -->
        <Border Grid.Row="1" 
                BorderThickness="0,1,0,0" 
                BorderBrush="{DynamicResource BorderBrush}"
                Padding="0,10,0,0"
                Margin="0,10,0,0">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <Button
                    x:Name="SaveButton"
                    Width="100"
                    Height="35"
                    Margin="0,0,10,0"
                    Content="💾 保存"
                    FontSize="14"
                    Style="{StaticResource ButtonPrimary}" />
                <Button
                    x:Name="CancelButton"
                    Width="100"
                    Height="35"
                    Content="✖ 取消"
                    FontSize="14" />
            </StackPanel>
        </Border>
    </Grid>
</hc:Window>
