<hc:Window x:Class="SceneTodo.Views.BackupManagementWindow"
          xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
          xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
          xmlns:hc="https://handyorg.github.io/handycontrol"
          xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
          xmlns:converters="clr-namespace:SceneTodo.Converters"
          Title="Backup Management"
          Width="900"
          Height="600"
          WindowStartupLocation="CenterScreen"
          Style="{StaticResource WindowWin10}">

    <Window.Resources>
        <converters:FileSizeConverter x:Key="FileSizeConverter"/>
        <converters:FileNameConverter x:Key="FileNameConverter"/>
    </Window.Resources>

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Title -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,16">
            <iconPacks:PackIconBootstrapIcons Kind="Database" 
                                          Width="24" 
                                          Height="24" 
                                          Margin="0,0,8,0"
                                          VerticalAlignment="Center"/>
            <TextBlock Text="Backup Management"
                      FontSize="20"
                      FontWeight="Bold"
                      VerticalAlignment="Center"/>
        </StackPanel>

        <!-- Action Buttons -->
        <StackPanel Grid.Row="1"
                   Orientation="Horizontal"
                   Margin="0,0,0,16">
            <Button Click="CreateBackup_Click"
                   Style="{StaticResource ButtonPrimary}"
                   Margin="0,0,8,0">
                <StackPanel Orientation="Horizontal">
                    <iconPacks:PackIconBootstrapIcons Kind="Download" 
                                                  Width="14" 
                                                  Height="14" 
                                                  Margin="0,0,6,0"/>
                    <TextBlock Text="Create Backup"/>
                </StackPanel>
            </Button>

            <Button Click="ImportBackup_Click"
                   Style="{StaticResource ButtonDefault}"
                   Margin="0,0,8,0">
                <StackPanel Orientation="Horizontal">
                    <iconPacks:PackIconMaterialDesign Kind="FolderOpen" 
                                                  Width="14" 
                                                  Height="14" 
                                                  Margin="0,0,6,0"/>
                    <TextBlock Text="Import Backup"/>
                </StackPanel>
            </Button>

            <Button Click="OpenBackupFolder_Click"
                   Style="{StaticResource ButtonDefault}"
                   Margin="0,0,8,0">
                <StackPanel Orientation="Horizontal">
                    <iconPacks:PackIconMaterialDesign Kind="FolderOutline" 
                                                  Width="14" 
                                                  Height="14" 
                                                  Margin="0,0,6,0"/>
                    <TextBlock Text="Open Folder"/>
                </StackPanel>
            </Button>

            <Button Click="RefreshList_Click"
                   Style="{StaticResource ButtonDefault}">
                <StackPanel Orientation="Horizontal">
                    <iconPacks:PackIconMaterialDesign Kind="Refresh" 
                                                  Width="14" 
                                                  Height="14" 
                                                  Margin="0,0,6,0"/>
                    <TextBlock Text="Refresh"/>
                </StackPanel>
            </Button>
        </StackPanel>

        <!-- Backup List -->
        <DataGrid Grid.Row="2"
                 x:Name="BackupsDataGrid"
                 AutoGenerateColumns="False"
                 CanUserAddRows="False"
                 CanUserDeleteRows="False"
                 SelectionMode="Single"
                 HeadersVisibility="All"
                 GridLinesVisibility="All"
                 Margin="0,0,0,16">
            <DataGrid.Columns>
                <!-- Type -->
                <DataGridTemplateColumn Header="Type" Width="100">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Border Padding="6,3"
                                   CornerRadius="3"
                                   HorizontalAlignment="Center">
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Type}" Value="0">
                                                <Setter Property="Background" Value="#2196F3"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Type}" Value="1">
                                                <Setter Property="Background" Value="#4CAF50"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Type}" Value="2">
                                                <Setter Property="Background" Value="#FF9800"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                                <TextBlock Foreground="White"
                                          FontWeight="Bold"
                                          FontSize="11"
                                          HorizontalAlignment="Center"
                                          Text="{Binding Type}"/>
                            </Border>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <!-- File Name -->
                <DataGridTextColumn Header="File Name"
                                   Binding="{Binding FilePath, Converter={StaticResource FileNameConverter}}"
                                   Width="*"
                                   MinWidth="200"/>

                <!-- Created -->
                <DataGridTextColumn Header="Created"
                                   Binding="{Binding CreatedAt, StringFormat={}{0:yyyy-MM-dd HH:mm:ss}}"
                                   Width="160"/>

                <!-- Size -->
                <DataGridTextColumn Header="Size"
                                   Binding="{Binding FileSize, Converter={StaticResource FileSizeConverter}}"
                                   Width="100"/>

                <!-- Version -->
                <DataGridTextColumn Header="Version"
                                   Binding="{Binding AppVersion}"
                                   Width="80"/>

                <!-- Actions -->
                <DataGridTemplateColumn Header="Actions" Width="220">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal"
                                       HorizontalAlignment="Center">
                                <Button Content="Restore"
                                       Tag="{Binding}"
                                       Click="RestoreSelected_Click"
                                       Style="{StaticResource ButtonSuccess}"
                                       Margin="0,0,4,0"
                                       Padding="8,4"/>

                                <Button Content="Export"
                                       Tag="{Binding}"
                                       Click="ExportSelected_Click"
                                       Style="{StaticResource ButtonDefault}"
                                       Margin="0,0,4,0"
                                       Padding="8,4"/>

                                <Button Content="Delete"
                                       Tag="{Binding}"
                                       Click="DeleteSelected_Click"
                                       Style="{StaticResource ButtonDanger}"
                                       Padding="8,4"/>
                            </StackPanel>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>

        <!-- Footer: Statistics and Close Button -->
        <Grid Grid.Row="3">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0"
                       Orientation="Horizontal">
                <TextBlock Text="Total Backups: "
                          VerticalAlignment="Center"
                          Foreground="{DynamicResource SecondaryTextBrush}"/>
                <TextBlock x:Name="TotalBackupsText"
                          VerticalAlignment="Center"
                          FontWeight="Bold"
                          Text="0"/>

                <TextBlock Text=" | Total Size: "
                          Margin="16,0,0,0"
                          VerticalAlignment="Center"
                          Foreground="{DynamicResource SecondaryTextBrush}"/>
                <TextBlock x:Name="TotalSizeText"
                          VerticalAlignment="Center"
                          FontWeight="Bold"
                          Text="0 B"/>
            </StackPanel>

            <Button Grid.Column="1"
                   Content="Close"
                   Click="Close_Click"
                   Style="{StaticResource ButtonDefault}"
                   MinWidth="100"
                   Padding="12,6"/>
        </Grid>
    </Grid>
</hc:Window>
