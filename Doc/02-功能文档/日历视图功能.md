# ?? 日历视图功能文档

> **功能版本**: 1.0  
> **实现会话**: Session-06 阶段2  
> **状态**: ? 已完成

---

## ?? 功能概述

### 功能描述
日历视图以月历的形式展示待办项的时间分布，用户可以直观地查看每天的任务数量，选择特定日期查看详细的待办项列表。

### 功能价值
- ? **时间视角** - 从时间维度查看任务分布
- ? **直观展示** - 日历形式一目了然
- ? **快速导航** - 月份切换和日期选择便捷
- ? **计划管理** - 便于月度和周计划安排

---

## ?? 使用方法

### 访问日历视图
1. 在主窗口左侧菜单栏
2. 点击**日历视图**按钮（日历图标）
3. 主内容区切换到日历视图页面

### 查看当月日历
- 打开日历视图后自动显示当前月份
- 今天的日期会有特殊标识（蓝色背景）
- 有待办项的日期显示数量标记 `[n]`

### 切换月份
- 点击**Previous**按钮查看上一个月
- 点击**Next**按钮查看下一个月
- 可以连续点击快速跳转

### 查看特定日期的待办
1. 点击日历中的任意日期
2. 底部自动显示该日期的所有待办项
3. 显示待办项的内容和描述
4. 优先级用彩色边框标识

---

## ??? 界面说明

### 日历视图布局
```
┌────────────────────────────────────────┐
│    Previous   2025 January   Next      │
├────────────────────────────────────────┤
│ Sun  Mon  Tue  Wed  Thu  Fri  Sat     │
├────────────────────────────────────────┤
│  29   30   31    1    2    3    4     │
│                 [2]                    │
│   5    6    7    8    9   10   11     │
│       [1]                              │
│  12   13   14   15   16   17   18     │
│                                        │
│  19   20   21   22   23   24   25     │
│                     [3]                │
│  26   27   28   29   30   31    1     │
├────────────────────────────────────────┤
│ 2025-01-02 Todos:                      │
│ ┌────────────────────────────────────┐ │
│ │ ● Complete documentation           │ │
│ │   Write user manual and guides     │ │
│ │                                    │ │
│ │ ● Code review                      │ │
│ │   Review pull requests             │ │
│ └────────────────────────────────────┘ │
└────────────────────────────────────────┘
```

### 界面元素说明

#### 1. 月份导航区
- **Previous** - 上一个月按钮
- **当前月份** - 格式：yyyy MMMM（如 2025 January）
- **Next** - 下一个月按钮

#### 2. 星期标题
- 显示：Sun Mon Tue Wed Thu Fri Sat
- 从周日开始（国际标准）

#### 3. 日期网格
- **6行7列** - 共42个日期格子
- **当前月** - 正常颜色显示
- **上/下月** - 灰色显示
- **今天** - 蓝色背景高亮
- **待办标记** - 红色数字 `[n]` 表示有n个待办

#### 4. 待办项列表
- 显示选中日期的所有待办项
- 每个待办显示内容和描述
- 优先级用底部边框颜色标识：
  - ?? 高优先级 - 红色
  - ?? 中优先级 - 蓝色  
  - ?? 低优先级 - 绿色

---

## ? 功能特性

### 日历显示
- **月视图** - 显示完整的月份日历
- **跨月显示** - 包含上月末和下月初的日期
- **今日标识** - 当前日期醒目标识
- **待办统计** - 每日显示待办项数量

### 月份导航
- **上一月** - 快速切换到上一个月
- **下一月** - 快速切换到下一个月
- **跨年** - 支持跨年切换（如12月→1月）
- **流畅切换** - 即时响应无延迟

### 日期选择
- **点击选择** - 点击任意日期
- **即时显示** - 立即显示该日待办
- **多次切换** - 可以连续选择不同日期
- **自动滚动** - 待办项过多时支持滚动

### 待办项展示
- **完整信息** - 显示标题和描述
- **优先级** - 彩色边框区分
- **自动更新** - 数据实时同步
- **递归统计** - 包含所有子待办项

---

## ?? 技术实现

### 数据模型

#### CalendarDay
```csharp
public class CalendarDay
{
    public DateTime Date { get; set; }        // 日期
    public int Day { get; set; }              // 日期数字
    public bool IsCurrentMonth { get; set; }  // 是否当前月
    public bool IsToday { get; set; }         // 是否今天
    public int TodoCount { get; set; }        // 待办数量
    public bool HasTodos => TodoCount > 0;    // 是否有待办
}
```

### 核心算法

#### 日历生成
```csharp
private void LoadCalendar()
{
    // 1. 获取当月第一天
    var firstDay = new DateTime(currentMonth.Year, currentMonth.Month, 1);
    
    // 2. 计算日历起始日（从周日开始）
    var startDay = firstDay.AddDays(-(int)firstDay.DayOfWeek);
    
    // 3. 生成42天（6周 x 7天）
    for (int i = 0; i < 42; i++)
    {
        var date = startDay.AddDays(i);
        // 统计该日待办数量...
    }
}
```

#### 待办项筛选
```csharp
private bool IsTodoOnDate(TodoItemModel todo, DateTime date)
{
    // 检查多个时间字段
    if (todo.StartTime?.Date == date.Date) return true;
    if (todo.EndTime?.Date == date.Date) return true;
    if (todo.ReminderTime?.Date == date.Date) return true;
    if (todo.GreadtedAt?.Date == date.Date) return true;
    return false;
}
```

---

## ?? 操作指南

### 查看本月任务分布
1. 打开日历视图
2. 观察日历上的数字标记
3. 数字越大表示任务越多
4. 今日会有蓝色高亮

### 查看特定日期的任务
1. 在日历上点击目标日期
2. 底部显示该日所有待办项
3. 查看任务的详细信息
4. 根据边框颜色了解优先级

### 查看上月/下月
1. 点击 Previous 查看上一个月
2. 点击 Next 查看下一个月
3. 观察月份标题的变化
4. 查看不同月份的任务分布

### 跨年查看
1. 在12月点击 Next 切换到次年1月
2. 在1月点击 Previous 切换到上年12月
3. 月份标题会显示正确的年份

---

## ?? 配置说明

### 时间字段关联
日历视图会检查以下时间字段来确定待办项所属日期：
- **StartTime** - 开始时间
- **EndTime** - 结束时间  
- **ReminderTime** - 提醒时间
- **GreadtedAt** - 创建时间

如果待办项的任意时间字段匹配指定日期，该待办就会显示在那一天。

### 星期起始日
- 默认从**周日**开始（国际标准）
- 当前版本不支持自定义
- 未来版本可能支持周一起始

---

## ?? 注意事项

### 使用限制
- 只显示**设置了时间字段**的待办项
- 没有时间的待办项不会在日历上显示
- 跨日任务会在多个日期显示

### 性能考虑
- 大量待办项可能影响日历加载速度
- 建议合理设置待办项的时间字段
- 子待办项也会被统计

### 数据准确性
- 待办项数量实时统计
- 数据与待办列表同步
- 修改待办后需重新打开日历视图刷新

---

## ?? 常见问题

### Q1: 某个待办项没有在日历上显示？
**A**: 检查该待办项是否设置了时间字段（开始时间、结束时间、提醒时间或创建时间）。

### Q2: 待办数量显示不准确？
**A**: 数量包含所有子待办项。如果一个待办项有3个子项，会统计为4个（1+3）。

### Q3: 今日标识不明显？
**A**: 今日会显示蓝色背景。如果看不到，可能是主题问题，尝试更换主题。

### Q4: 点击日期没有反应？
**A**: 确保点击的是日期单元格内部。如果问题持续，尝试重启应用。

### Q5: 跨月的日期显示是灰色的？
**A**: 这是正常的。上月末和下月初的日期会显示为灰色，表示不属于当前月。

---

## ?? 使用场景

### 月度计划
1. 查看本月日历
2. 观察任务分布是否均衡
3. 识别任务集中的日期
4. 合理调整任务安排

### 周计划
1. 查看本周（当前月份）
2. 点击本周的每一天
3. 查看具体任务
4. 规划本周工作

### 回顾总结
1. 切换到上个月
2. 查看已完成的任务分布
3. 了解工作节奏
4. 总结经验教训

### 未来规划
1. 切换到下个月
2. 查看计划中的任务
3. 识别任务冲突
4. 提前做好准备

---

## ?? 功能对比

### 与历史记录的区别

| 维度 | 日历视图 | 历史记录 |
|------|---------|---------|
| 视角 | 时间维度 | 状态维度 |
| 展示方式 | 日历形式 | 列表形式 |
| 数据范围 | 所有待办（有时间） | 已完成待办 |
| 主要用途 | 计划和分布 | 回顾和恢复 |
| 筛选方式 | 按月/按日 | 按日期区间 |

### 与待办列表的关系
- **数据源相同** - 都来自同一个待办数据库
- **实时同步** - 修改后自动更新
- **互补功能** - 列表看结构，日历看时间
- **可以切换** - 随时在两个视图间切换

---

## ?? 最佳实践

### 时间管理技巧
1. **均衡分布** - 避免某几天任务过多
2. **预留缓冲** - 不要把日程排满
3. **优先级分散** - 高优先级任务分散开
4. **定期回顾** - 每周查看下周日历

### 提高效率
1. 每天早上查看今日任务
2. 每周末规划下周任务
3. 每月初规划本月任务
4. 使用日历识别任务冲突

### 数据质量
1. 为待办项设置准确的时间
2. 及时更新任务的时间字段
3. 定期清理过期的待办项
4. 合理使用子待办项

---

## ?? 未来计划

### 可能的增强
- [ ] 周视图模式
- [ ] 年视图模式
- [ ] 今天按钮快速跳转
- [ ] 周一起始选项
- [ ] 待办项直接编辑
- [ ] 拖拽调整日期
- [ ] 任务密度热力图
- [ ] 月度统计报表

---

## ?? 相关功能

### 结合使用
- **+ 待办列表** - 日历查看，列表管理
- **+ 历史记录** - 日历规划，历史回顾
- **+ 优先级** - 日历分布，优先级标识
- **+ 提醒时间** - 日历显示提醒日期

---

## ?? 技术支持

### 遇到问题？
1. 查看[常见问题](#常见问题)
2. 查看[使用指南](#操作指南)
3. 查看[Session-06完成总结](../01-会话记录/Session-06/Session-06完成总结.md)
4. 提交 GitHub Issue

### 技术文档
- [日历算法详解](../01-会话记录/Session-06-Part2/阶段2完成报告.md)
- [CalendarViewModel源码](../../ViewModels/CalendarViewModel.cs)
- [CalendarDay模型](../../Models/CalendarDay.cs)

---

**功能版本**: 1.0  
**文档版本**: 1.0  
**创建日期**: 2025-01-02  
**最后更新**: 2025-01-02  
**相关会话**: Session-06 阶段2

**享受日历视图带来的便捷时间管理！** ??
