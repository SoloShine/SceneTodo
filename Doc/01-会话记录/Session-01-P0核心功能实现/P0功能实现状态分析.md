> ?? **[已过时 - 归档文档]**  
> **创建日期**: Session-01  
> **状态**: 本文档标记的很多功能已在后续会话中实现  
> **请参考**: `Doc/00-必读/项目状态总览.md` 获取最新状态  
> **用途**: 仅供了解Session-01时的项目状态  

---
# SceneTodo P0核心功能实现状态分析

## 文档说明
本文档用于跟踪PRD中P0（必须实现）核心功能的实现状态，供开发团队和AI Agent参考使用。

---

## 一、待办挂载/展示功能（P0-核心功能）

### 1.1 待办事项基础管理 ? 已实现

#### 已完成功能：
- ? 新增、编辑、删除、标记完成/未完成操作
  - 实现位置: `ViewModels/MainWindowViewModel.cs`
  - 方法: `AddTodoItem`, `EditTodoItem`, `DeleteTodoItem`, `ToggleIsCompleted`
  
- ? 设置标题、详情描述、截止时间
  - 实现位置: `Models/TodoItem.cs`
  - 字段: `Name`, `Description`, `Content`, `EndTime`, `StartTime`, `ReminderTime`
  
- ? 分层级管理（树形结构）
  - 实现位置: `Models/TodoItem.cs` 的 `ParentId` 和 `Models/TodoItemModel.cs` 的 `SubItems`
  - 数据库支持: 已实现

#### ? 缺失功能：
- ? **优先级设置（高/中/低）**
  - 需要添加: `Priority` 枚举字段到 `TodoItem` 模型
  - 需要修改: `EditTodoItemWindow.xaml` 添加优先级选择控件
  - 需要修改: 遮盖层展示时根据优先级显示不同样式（红色/黄色/灰色边框）

- ? **自定义分类标签**
  - 需要添加: `Category` 或 `Tags` 字段（可以是字符串或多对多关系）
  - 需要实现: 分类管理UI
  - 需要实现: 按分类筛选功能

---

### 1.2 待办挂载功能 ? 部分实现

#### 已完成功能：
- ? 手动选择指定桌面应用窗口
  - 实现位置: `Views/SelectRunningAppWindow.xaml.cs`
  - 实现位置: `Models/TodoItemModel.cs` 的 `SelectApp` 和 `SelectRunningApp` 方法

- ? 待办事项与挂载目标的绑定
  - 实现位置: `Models/TodoItem.cs` 的 `AppPath` 字段
  - 支持一对多绑定（同一个应用可以有多个待办）

#### ?? 部分实现：
- ?? **遮盖层位置设置**
  - 当前状态: 固定显示在窗口下方
  - 实现位置: `ViewModels/MainWindowViewModel.cs` 的 `UpdateOverlayPosition` 方法
  - **需要添加**: 
    - UI控件让用户选择位置（左上/右上/左下/右下/居中）
    - 保存位置配置到数据库
    - 支持拖拽微调位置功能

#### ? 缺失功能：
- ? **一对多绑定的完整支持**
  - 当前: 一个待办只能挂载到一个应用
  - 需要实现: 一个待办可以挂载到多个应用的能力
  - 需要设计: 多对多关系表或JSON字段存储多个AppPath

---

### 1.3 遮盖层展示功能 ?? 部分实现

#### 已完成功能：
- ? 半透明遮盖层展示
  - 实现位置: `Views/OverlayWindow.xaml`
  - 透明度可调: `MainWindowModel.OverlayOpacity` (0.1-1.0)

- ? 窗口最小化/恢复时同步显示/隐藏
  - 实现位置: `ViewModels/MainWindowViewModel.cs` 的 `HandleOverlayWindow` 方法

- ? 窗口关闭时自动解除挂载
  - 实现位置: `ViewModels/MainWindowViewModel.cs` 的 `AutoInjectOverlays` 方法

#### ?? 部分实现：
- ?? **透明度调节范围**
  - 当前: 0.1-1.0
  - PRD要求: 0.3-0.8
  - 修改位置: `Views/ThemeSettingsWindow.xaml` 的滑块范围

#### ? 缺失功能：
- ? **优先级样式区分**
  - 需要实现: 高优先级红色边框、中优先级黄色边框、低优先级灰色边框
  - 修改位置: `Views/OverlayWindow.xaml` 添加样式绑定

- ? **折叠/展开待办列表**
  - 当前: 所有待办始终显示
  - 需要添加: 折叠按钮和折叠状态管理
  - 折叠时: 只显示待办数量提示

- ? **位置选择和拖拽功能**
  - 见 1.2 节缺失功能

---

### 1.4 待办交互功能 ?? 部分实现

#### 已完成功能：
- ? 点击待办查看详情
  - 实现位置: `Views/TodoItemControl.xaml` 和对应的 `EditTodoItemCommand`

- ? 快速标记完成
  - 实现位置: `Views/TodoItemControl.xaml` 的复选框
  - 命令: `ToggleIsCompletedCommand`

#### ? 缺失功能：
- ? **关联操作功能（打开网页/文件/应用）**
  - 需要添加: `TodoItem` 模型中的 `LinkedActions` 字段（JSON或关联表）
  - 需要实现: 
    - 添加关联操作的UI
    - 执行关联操作的逻辑
    - 支持类型: 打开指定网页、打开本地文件、唤起指定应用

- ? **完成后归档至历史记录**
  - 当前: 完成的待办仍然显示在列表中
  - 需要实现: 
    - 历史记录视图/窗口
    - 完成后自动移除并归档的逻辑
    - 历史记录的查询和恢复功能

---

## 二、基础功能（P0-必须实现）

### 2.1 账号管理 ? 未实现

#### 当前状态：
- 无账号系统
- 数据仅存储在本地数据库

#### 需要实现：
- ? **游客模式**（当前默认是游客模式，但没有明确标识）
- ? **账号登录（手机号/邮箱）**
  - 需要实现: 登录窗口
  - 需要实现: 用户认证服务（可能需要后端API）
  - 需要实现: 用户表
  
- ? **数据同步**
  - 登录后自动同步待办数据、插件列表、脚本等
  - 需要实现: 云端数据存储和同步机制

---

### 2.2 数据备份与恢复 ? 未实现

#### 当前状态：
- 数据存储在本地SQLite数据库
- 配置文件: `app_associations.json`
- 无备份和恢复功能

#### 需要实现：
- ? **本地备份**
  - 导出为JSON文件
  - 包含: 待办事项、配置、主题设置等
  
- ? **云端备份**
  - 登录后自动同步
  - 需要配置同步周期
  
- ? **恢复功能**
  - 从备份文件恢复数据
  - UI入口: 可以在主窗口菜单中添加

**实现建议位置：**
- 添加命令到 `MainWindowViewModel`: `ExportBackupCommand`, `ImportBackupCommand`
- 创建服务类: `Services/BackupService.cs`

---

### 2.3 系统设置 ?? 部分实现

#### 已完成功能：
- ? 遮盖层默认透明度配置
  - 实现位置: `Views/ThemeSettingsWindow.xaml`
  - 存储位置: `MainWindowModel.OverlayOpacity`

#### ? 缺失功能：
- ? **待办提醒方式配置**
  - 弹窗提醒
  - 声音提醒
  - 托盘通知
  - 需要添加: 设置界面和提醒配置字段

- ? **脚本超时时间配置**
  - PRD要求: 10-60秒可配置
  - 需要添加: 配置字段和设置UI

- ? **数据自动备份周期配置**
  - 需要添加: 周期选择（每天/每周/每月）
  - 需要实现: 定时备份任务

**实现建议：**
- 扩展 `MainWindowModel` 添加这些配置字段
- 在 `ThemeSettingsWindow` 或创建新的 `SystemSettingsWindow` 添加UI

---

### 2.4 历史记录 ? 未实现

#### 需要实现：
- ? **已完成待办事项记录**
  - 当前: 完成的待办仍在主列表中
  - 需要: 单独的历史记录视图
  
- ? **筛选功能**
  - 按时间筛选
  - 按分类筛选
  
- ? **历史记录窗口/视图**
  - 创建: `Views/HistoryWindow.xaml`
  - 添加菜单入口

---

## 三、PRD中其他P0级功能检查

### 3.1 悬浮窗性能要求

#### 已实现：
- ? 自动跟随窗口移动
  - 实现位置: `ViewModels/MainWindowViewModel.cs` 的定时器更新位置

#### 需要验证：
- ?? **性能指标**
  - 加载时间 ≤0.5秒
  - 响应时间 ≤0.2秒
  - 不影响原应用操作流畅度
  - 建议: 添加性能监测和日志

---

## 四、实现优先级建议

### 高优先级（立即实现）：
1. **优先级字段和样式** - 核心展示功能
2. **遮盖层位置选择** - 重要的用户体验功能
3. **关联操作功能** - PRD明确要求
4. **历史记录功能** - 完整的待办管理流程

### 中优先级（尽快实现）：
5. **折叠/展开功能** - 改善用户体验
6. **数据备份与恢复** - 数据安全重要功能
7. **分类标签管理** - 增强组织能力
8. **系统设置扩展** - 提醒方式、自动备份等

### 低优先级（后续实现）：
9. **账号系统** - 需要后端支持，可以后续迭代
10. **一对多挂载** - 功能增强，非必需

---

## 五、数据库Schema需要添加的字段

### TodoItem表需要添加：
```sql
-- 优先级字段
Priority INTEGER DEFAULT 1  -- 0=低, 1=中, 2=高

-- 分类/标签字段
Category TEXT  -- 简单实现：单个分类
Tags TEXT      -- 或者：多标签，JSON格式存储

-- 遮盖层位置配置
OverlayPosition INTEGER DEFAULT 0  -- 0=下方, 1=左上, 2=右上, 3=左下, 4=右下, 5=居中
OverlayOffsetX REAL DEFAULT 0
OverlayOffsetY REAL DEFAULT 0

-- 关联操作
LinkedActions TEXT  -- JSON格式存储关联操作列表
```

### 需要添加新表：
```sql
-- 用户表（如果实现账号系统）
CREATE TABLE Users (
    Id TEXT PRIMARY KEY,
    Username TEXT,
    Email TEXT,
    PasswordHash TEXT,
    CreatedAt DATETIME,
    LastLoginAt DATETIME
);

-- 历史记录表（或使用 IsCompleted + CompletedAt 查询）
-- 当前设计已经支持，只需要UI展示

-- 备份记录表
CREATE TABLE Backups (
    Id TEXT PRIMARY KEY,
    BackupPath TEXT,
    BackupTime DATETIME,
    BackupType TEXT  -- Local/Cloud
);
```

---

## 六、代码文件需要创建

### Models:
- `Models/Priority.cs` - 优先级枚举
- `Models/LinkedAction.cs` - 关联操作模型
- `Models/BackupRecord.cs` - 备份记录模型

### Services:
- `Services/BackupService.cs` - 备份和恢复服务
- `Services/ReminderService.cs` - 提醒服务（集成到现有的 TodoItemSchedulerService）
- `Services/SyncService.cs` - 数据同步服务（账号系统相关）

### Views:
- `Views/HistoryWindow.xaml` - 历史记录窗口
- `Views/SystemSettingsWindow.xaml` - 系统设置窗口（或扩展现有的ThemeSettingsWindow）
- `Views/LoginWindow.xaml` - 登录窗口（如果实现账号系统）
- `Views/CategoryManagerWindow.xaml` - 分类管理窗口

### ViewModels:
- 对应的ViewModel文件

---

## 七、下一步行动计划

### 第一阶段（核心功能补全）：
1. 添加优先级字段和UI
2. 实现优先级样式展示
3. 实现遮盖层位置选择
4. 实现关联操作功能
5. 实现历史记录功能

### 第二阶段（功能增强）：
6. 实现折叠/展开功能
7. 实现数据备份与恢复
8. 实现分类标签管理
9. 扩展系统设置

### 第三阶段（高级功能）：
10. 实现账号系统（可选，需要后端）
11. 实现数据同步
12. 性能优化和测试

---

## 八、注意事项

1. **数据库迁移**: 添加新字段时需要考虑数据库迁移策略
2. **向后兼容**: 确保新功能不影响现有数据
3. **性能监测**: 添加性能日志，确保满足PRD性能要求
4. **用户体验**: UI/UX设计要简洁直观，符合PRD的易用性需求
5. **测试**: 每个功能实现后需要充分测试

---

## 更新记录
- 2025-01-XX: 初始版本创建
- 后续更新请在此处记录

---

**文档维护**: 每次实现新功能后，请更新此文档的对应状态标记（? → ?? → ?）

