# SceneTodo开发任务总览

本文档为AI Agent和开发者提供当前项目状态的快速概览和任务清单。

---

## ?? 文档导航

1. **P0功能实现状态分析.md** - 详细的功能实现状态对比
2. **P0核心功能实现指南.md** - 具体的代码实现指导
3. **数据库Schema变更清单.md** - 数据库结构变更说明
4. **本文档** - 快速任务清单和优先级规划

---

## ? 已完成的P0功能

### 待办基础管理
- [x] 新增、编辑、删除待办
- [x] 标记完成/未完成
- [x] 设置标题、描述、时间字段
- [x] 树形结构（父子关系）
- [x] 数据库持久化

### 待办挂载
- [x] 选择运行中的应用
- [x] 选择应用文件
- [x] 待办与应用的一对一绑定
- [x] 应用路径存储

### 遮盖层展示
- [x] 半透明遮盖层
- [x] 透明度可调（0.1-1.0）
- [x] 窗口跟随移动
- [x] 窗口最小化/恢复同步
- [x] 窗口关闭自动解除挂载

### 基础功能
- [x] 主题设置（亮色/暗色）
- [x] 主题颜色自定义
- [x] 悬浮窗背景颜色配置
- [x] 配置持久化（JSON文件）
- [x] 托盘图标
- [x] 数据库架构（SQLite + EF Core）
- [x] 定时任务框架（Quartz）

---

## ? 缺失的P0核心功能

### ?? 高优先级（必须立即实现）

#### 1. 优先级功能 ??? ? 已完成
**影响**: 核心展示功能，PRD明确要求
**工作量**: 2-3小时
**状态**: ? 已完成（2025-01-XX）

**完成的工作**:
- [x] Priority枚举已存在（5级：VeryLow, Low, Medium, High, VeryHigh）
- [x] TodoItem添加Priority字段
- [x] 编辑界面添加优先级选择（5个选项）
- [x] 遮盖层和主界面显示优先级样式（带颜色边框）
- [x] 数据库自动支持（EF Core）
- [x] PriorityToBorderBrushConverter转换器

**涉及文件**:
- `Converters/PriorityToBorderBrushConverter.cs` (新建)
- `Models/TodoItem.cs` (已有Priority定义)
- `Models/TodoItemModel.cs` (修改)
- `Views/EditTodoItemWindow.xaml` (修改)
- `Views/EditTodoItemWindow.xaml.cs` (修改)
- `Views/TodoItemControl.xaml` (修改)
- `ViewModels/MainWindowViewModel.cs` (修改)

---

#### 2. 关联操作功能 ??? ? 已完成
**影响**: 核心交互功能，提升用户效率
**工作量**: 4-5小时
**状态**: ? 已完成（2025-01-XX）

**完成的工作**:
- [x] 创建LinkedAction模型和LinkedActionType枚举
- [x] 支持三种类型：打开网页/打开文件/启动应用
- [x] TodoItem添加LinkedActionsJson字段
- [x] 实现ExecuteLinkedActionCommand命令
- [x] 创建EditLinkedActionWindow编辑窗口
- [x] 编辑界面添加关联操作管理（ListBox + 按钮）
- [x] 主界面和遮盖层显示关联操作按钮

**涉及文件**:
- `Models/LinkedAction.cs` (新建)
- `Models/TodoItem.cs` (修改)
- `Models/TodoItemModel.cs` (修改)
- `ViewModels/MainWindowViewModel.cs` (修改)
- `Views/EditLinkedActionWindow.xaml` (新建)
- `Views/EditLinkedActionWindow.xaml.cs` (新建)
- `Views/EditTodoItemWindow.xaml` (修改)
- `Views/EditTodoItemWindow.xaml.cs` (修改)
- `Views/TodoItemControl.xaml` (修改)

---

#### 3. 历史记录功能 ??? ? 已完成
**影响**: 完整的待办管理流程
**工作量**: 3-4小时
**状态**: ? 已完成（2025-01-XX）

**完成的工作**:
- [x] 创建HistoryWindowViewModel和HistoryWindow
- [x] 实现按时间筛选（开始日期和结束日期）
- [x] 实现恢复待办功能（将完成的待办恢复为未完成）
- [x] 实现删除历史记录功能（永久删除）
- [x] 添加ShowHistoryCommand到MainWindowViewModel
- [x] 修复MainWindowViewModel命名空间错误

**涉及文件**:
- `ViewModels/HistoryWindowViewModel.cs` (新建)
- `Views/HistoryWindow.xaml` (新建)
- `Views/HistoryWindow.xaml.cs` (新建)
- `ViewModels/MainWindowViewModel.cs` (修改)

---

#### 4. 遮盖层位置选择 ?? ? 已完成
**影响**: 重要的用户体验功能
**工作量**: 3-4小时
**状态**: ? 已完成（2025-01-XX）

**完成的工作**:
- [x] 创建OverlayPosition枚举（6种位置）
- [x] TodoItem添加位置和偏移字段（OverlayPosition, OverlayOffsetX, OverlayOffsetY）
- [x] 修改UpdateOverlayPosition方法支持多位置
- [x] 编辑界面添加位置选择（ComboBox）和偏移量设置（NumericUpDown）
- [x] 修改MainWindowViewModel支持新属性
- [x] 修改数据库备份恢复逻辑
- [x] 在主窗口添加历史记录按钮

**涉及文件**:
- `Models/TodoItem.cs` (添加OverlayPosition枚举和3个新属性)
- `Models/TodoItemModel.cs` (修改)
- `Views/EditTodoItemWindow.xaml` (添加位置选择UI)
- `Views/EditTodoItemWindow.xaml.cs` (添加相关方法)
- `ViewModels/MainWindowViewModel.cs` (更新UpdateOverlayPosition方法)
- `Services/Database/DatabaseInitializer.cs` (修改)
- `MainWindow.xaml` (添加历史记录按钮)

---

### ?? 中优先级（尽快实现）

#### 5. 折叠/展开功能 ?
**工作量**: 2-3小时
**关键任务**:
- [ ] 添加IsOverlayCollapsed字段
- [ ] OverlayWindow添加折叠按钮
- [ ] 折叠时显示待办数量
- [ ] 保存折叠状态

---

#### 6. 数据备份与恢复 ??
**工作量**: 4-5小时
**关键任务**:
- [ ] 创建BackupService
- [ ] 实现导出备份（JSON格式）
- [ ] 实现导入备份
- [ ] 添加UI入口
- [ ] （可选）自动备份功能

---

#### 7. 分类标签管理 ?
**工作量**: 3-4小时
**关键任务**:
- [ ] TodoItem添加Category/TagsJson字段
- [ ] 编辑界面添加分类选择
- [ ] 创建分类管理窗口
- [ ] 实现分类筛选

---

#### 8. 系统设置扩展 ?
**工作量**: 2-3小时
**关键任务**:
- [ ] 添加提醒方式配置
- [ ] 添加脚本超时配置
- [ ] 添加自动备份周期配置
- [ ] 扩展ThemeSettingsWindow或创建新窗口

---

### ?? 低优先级（后续迭代）

#### 9. 账号系统
**工作量**: 10+ 小时
**需要**: 后端API支持
**关键任务**:
- [ ] 创建User模型
- [ ] 实现登录/注册界面
- [ ] 实现云端数据同步
- [ ] Token管理

---

#### 10. 一对多挂载
**工作量**: 4-5小时
**关键任务**:
- [ ] 修改数据结构支持多AppPath
- [ ] 修改UI支持选择多个应用
- [ ] 修改挂载逻辑

---

## ?? 工作量估算（总计）

### 高优先级任务（? 已完成 4/4）
- ? 优先级功能: 2-3小时
- ? 关联操作: 4-5小时
- ? 历史记录: 3-4小时
- ? 位置选择: 3-4小时
**小计**: 12-16小时 ? 已完成

### 中优先级任务
- 折叠展开: 2-3小时
- 备份恢复: 4-5小时
- 分类管理: 3-4小时
- 系统设置: 2-3小时
**小计**: 11-15小时

### 总计（不含低优先级）
**23-31小时** （约3-4个工作日）
**已完成**: 12-16小时 ?

---

## ??? 建议实现顺序

### 第1天（6-8小时）? 已完成
1. ? 数据库迁移准备
2. ? 优先级功能实现
3. ? 关联操作功能实现

### 第2天（6-8小时）? 已完成
4. ? 历史记录功能实现
5. ? 遮盖层位置选择实现
6. ? 在主窗口添加历史记录按钮

### 第3天（6-8小时）?? 待开始
6. 折叠展开功能实现
7. 数据备份与恢复实现

### 第4天（5-7小时）?? 待开始
8. 分类标签管理实现
9. 系统设置扩展实现
10. 测试和bug修复

---

## ?? 开发环境配置

### 必需工具
- Visual Studio 2022 或更高版本
- .NET 8 SDK
- SQLite浏览器工具（用于调试数据库）

### NuGet包（已安装）
- Microsoft.EntityFrameworkCore (9.0.4)
- Microsoft.EntityFrameworkCore.Sqlite (9.0.4)
- HandyControl (3.5.1)
- MahApps.Metro.IconPacks (5.1.0)
- Quartz (3.8.0)

---

## ?? 编码规范提醒

### 命名约定
- 类名：PascalCase
- 方法名：PascalCase
- 私有字段：camelCase
- 属性：PascalCase
- 常量：PascalCase

### 注释规范
- 所有public方法必须有XML注释
- 复杂逻辑添加行内注释
- 保持注释与代码同步

### Git提交规范
```
feat: 添加优先级功能
fix: 修复遮盖层位置计算错误
docs: 更新README
refactor: 重构数据库初始化逻辑
test: 添加备份功能测试
```

---

## ?? 测试检查清单

每完成一个功能后，请验证：

### 功能测试
- [ ] 新增功能正常工作
- [ ] 不影响现有功能
- [ ] 数据正确保存到数据库
- [ ] 数据正确加载

### UI测试
- [ ] 界面显示正常
- [ ] 响应式布局正常
- [ ] 深色/浅色主题都正常

### 性能测试
- [ ] 启动时间 ≤ 3秒
- [ ] 遮盖层加载 ≤ 0.5秒
- [ ] 无明显卡顿

### 兼容性测试
- [ ] Windows 10测试通过
- [ ] Windows 11测试通过
- [ ] 不同DPI缩放正常显示

---

## ?? 参考资料

### PRD文档
- `Doc/桌面应用待办软件产品需求规格说明书（PRD）初稿.md`

### 技术文档
- [HandyControl文档](https://github.com/HandyOrg/HandyControl)
- [EF Core文档](https://docs.microsoft.com/ef/core/)
- [Quartz.NET文档](https://www.quartz-scheduler.net/)

### 设计参考
- PRD中的用户故事
- README.md中的已完成功能

---

## ?? 已知问题

当前项目中的已知问题（可以在实现新功能时一并修复）：

1. ?? 透明度范围是0.1-1.0，PRD要求0.3-0.8
2. ?? 完成的待办仍显示在主列表中
3. ?? 遮盖层位置固定在窗口下方
4. ?? 无备份提示或自动备份

---

## ?? 实现建议

### 开发技巧
1. **增量开发**: 每完成一个小功能就测试和提交
2. **数据迁移**: 先在测试数据库上验证迁移脚本
3. **UI原型**: 先创建静态UI，再实现逻辑
4. **代码复用**: 查看现有代码，复用已有的转换器和命令

### 调试技巧
1. 使用Debug.WriteLine记录关键信息
2. 使用SQLite浏览器查看数据库状态
3. 在ViewModel中添加断点调试命令执行
4. 使用HandyControl的消息提示调试UI

---

## ?? 需要帮助？

如果在实现过程中遇到问题：

1. 查看对应的实现指南文档
2. 参考现有代码中类似功能的实现
3. 检查PRD中的具体需求描述
4. 查看技术文档和API文档

---

## ?? 更新记录

- 2025-01-XX: 创建文档，分析P0功能缺失情况
- 后续更新请在此处记录

---

**文档维护说明**：
- 完成任务后请更新复选框状态
- 发现新问题请添加到"已知问题"
- 有新的实现建议请补充到相应章节
